# Markdown 聊天记录导入格式说明

本文档介绍 Custard 应用支持的新版 Markdown 格式聊天记录导入规范。

> **注意**：Custard 采用了简洁的基于 HTML 注释的解析模式。**每个 Markdown 文件对应一个独立的对话**。不再支持在单个文件中使用 `---` 分割多个对话。

## 📋 格式概述

新版格式使用简单的键值对注释来存储元数据，无需编写复杂的 JSON。

- ✅ **简单易写**：使用 `key=value` 格式，支持简写
- ✅ **大量缺省**：只需指定必要信息，其他自动生成
- ✅ **精准分割**：基于注释分割消息，内容更纯净
- ✅ **批量支持**：通过 Zip 压缩包支持批量导入/导出

## 🔧 基本结构 (单文件)

每个 `.md` 文件代表一个对话。

```markdown
<!-- chat-info: title=我的对话 -->

# 我的对话

<!-- msg: user -->
## 👤 User

你好

<!-- msg: ai, model=gpt-4 -->
## 🤖 Assistant

你好！
```

## 📝 详细规范

### 1. 全局元数据 (`chat-info`)

文件头部包含 `chat-info` 注释。

**格式**：
```html
<!-- chat-info: key=value, key=value -->
```

**支持字段**（均可选）：
| 字段 | 说明 | 缺省值 |
|------|------|--------|
| `title` | 对话标题 | "Imported from Markdown" |
| `created` | 创建时间 | 当前导入时间 |
| `id` | 唯一标识符 | 自动生成 UUID |
| `group` | 分组名称 | "从 Markdown 导入" |

**示例**：
```markdown
<!-- chat-info: title=Python 学习笔记, group=编程 -->
```

### 2. 消息元数据 (`msg`)

每条消息以 `msg` 注释开头。

**格式**：
```html
<!-- msg: role, key=value... -->
```

**支持简写**：
可以直接写角色名，无需 `role=` 前缀。
- `<!-- msg: user -->` 等同于 `<!-- msg: role=user -->`
- `<!-- msg: ai -->` 等同于 `<!-- msg: role=ai -->`

**支持字段**：
| 字段 | 说明 | 缺省值 |
|------|------|--------|
| `role` | 角色 (user/ai) | user |
| `model` | 模型名称 | markdown |
| `timestamp` | 时间戳 | 自动顺序生成 |

**示例**：
```markdown
<!-- msg: user -->
<!-- msg: ai, model=gpt-4 -->
<!-- msg: user, timestamp=1700000000000 -->
```

### 3. 消息内容

紧跟在 `msg` 注释后的内容即为消息正文。
如果在注释后紧接着写了 `## User` 或 `## Assistant` 标题，导入时会自动忽略该行（作为装饰）。

## 📦 批量导入/导出 (Zip)

Custard 支持通过 **Zip 压缩包** 来管理多个对话。

### 导出
当导出多个对话为 Markdown 格式时，系统会生成一个 `.zip` 文件。
- 压缩包内包含多个 `.md` 文件。
- 每个 `.md` 文件对应一个对话，文件名为对话标题。

### 导入
你可以将多个符合上述规范的 Markdown 文件打包成 `.zip` 文件进行一次性导入。
- 系统会自动解压并读取包内所有 `.md` 文件。
- 每个文件将被导入为一个独立的对话记录。

## ⚠️ 常见问题

### Q: 可以在一个文件中混合不同的对话吗？
**A:** **不再支持**。请将每个对话保存为单独的 `.md` 文件。如果在单个文件中使用 `---`，它将被视为正文内容的一部分。

### Q: 我可以手动编写这种格式吗？
**A:** 可以。只需确保文件扩展名为 `.md`，并且包含 `<!-- msg: ... -->` 注释即可。

### Q: 为什么我的文件无法导入？
**A:** 请检查：
1. 文件是否包含 `<!-- msg: ... -->` 注释。
2. 如果是 Zip 包，请确保里面包含的是 `.md` 文件。
